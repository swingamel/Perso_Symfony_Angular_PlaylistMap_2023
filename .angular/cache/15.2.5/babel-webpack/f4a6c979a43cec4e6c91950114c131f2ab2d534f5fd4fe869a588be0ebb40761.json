{"ast":null,"code":"import { HttpParams } from '@angular/common/http';\nimport { catchError, from, map, Observable, takeWhile } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class SpotifyService {\n  constructor(http) {\n    this.http = http;\n    this.apiUrl = 'https://mmi.unilim.fr/~morap01/L250/public/index.php/api';\n    this.apiUrls = 'https://mmi.unilim.fr/~morap01/L250/public/index.php/api/albums';\n  }\n  getAlbums() {\n    return this.http.get(`${this.apiUrl}/albums`);\n  }\n  getAlbum(id) {\n    return from(fetch(`${this.apiUrl}/albums/${id}`).then(response => response.json()));\n  }\n  getSong(id) {\n    return this.http.get(`${this.apiUrl}/songs/${id}`);\n  }\n  searchSongs(query) {\n    return this.http.get(`${this.apiUrl}/songs?title=${query}`).pipe(map(response => {\n      if (Array.isArray(response)) {\n        return response;\n      } else {\n        return [response];\n      }\n    }));\n  }\n  searchArtists(query) {\n    return this.http.get(`${this.apiUrl}/artists?name=${query}`).pipe(map(response => {\n      if (Array.isArray(response)) {\n        return response;\n      } else {\n        return [response];\n      }\n    }));\n  }\n  searchAlbums(query) {\n    return this.http.get(`${this.apiUrl}/albums?title=${query}`).pipe(map(response => {\n      if (Array.isArray(response)) {\n        return response;\n      } else {\n        return [response];\n      }\n    }));\n  }\n  /*  searchPlaylists(keyword: string): Observable<Playlist[]> {\r\n      const url = `${this.apiUrl}/playlists?q=${keyword}`;\r\n      return this.http.get<Playlist[]>(url);\r\n    }*/\n  getArtistAlbums(artistName, page) {\n    let params = new HttpParams().set('artist.name', artistName);\n    if (page) {\n      params = params.set('page', page.toString());\n    }\n    return this.http.get(this.apiUrls, {\n      params\n    });\n  }\n  getAllPlaylists(searchTerm) {\n    let id = 1;\n    const playlists = [];\n    return new Observable(observer => {\n      const getPlaylist = () => {\n        let params = new HttpParams();\n        if (searchTerm) {\n          params = params.append('q', searchTerm);\n        }\n        this.http.get(`${this.apiUrl}/playlists/${id}`, {\n          params\n        }).pipe(map(response => {\n          if (!searchTerm || response.name.toLowerCase().includes(searchTerm.toLowerCase())) {\n            playlists.push(response);\n          }\n          id++;\n          if (response.id) {\n            // continue the loop\n            getPlaylist();\n          } else {\n            observer.next(playlists);\n            observer.complete();\n          }\n        }), catchError(error => {\n          // stop the loop and return the playlists that have been fetched so far\n          observer.next(playlists);\n          observer.complete();\n          return [];\n        }), takeWhile(() => id < 1000) // limit the loop to a maximum of 1000 iterations\n        ).subscribe();\n      };\n      getPlaylist();\n    });\n  }\n}\nSpotifyService.ɵfac = function SpotifyService_Factory(t) {\n  return new (t || SpotifyService)(i0.ɵɵinject(i1.HttpClient));\n};\nSpotifyService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: SpotifyService,\n  factory: SpotifyService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["HttpParams","catchError","from","map","Observable","takeWhile","SpotifyService","constructor","http","getAlbums","get","apiUrl","getAlbum","id","fetch","then","response","json","getSong","searchSongs","query","pipe","Array","isArray","searchArtists","searchAlbums","getArtistAlbums","artistName","page","params","set","toString","apiUrls","getAllPlaylists","searchTerm","playlists","observer","getPlaylist","append","name","toLowerCase","includes","push","next","complete","error","subscribe","factory","providedIn"],"sourceRoot":"","sources":["C:\\IUT\\spotizer\\src\\app\\services\\spotify.service.ts"],"sourcesContent":["import {Injectable} from '@angular/core';\r\nimport {HttpClient, HttpParams} from '@angular/common/http';\r\nimport {catchError, from, map, Observable, takeWhile} from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SpotifyService {\r\n\r\n  private apiUrl = 'https://mmi.unilim.fr/~morap01/L250/public/index.php/api';\r\n  private apiUrls = 'https://mmi.unilim.fr/~morap01/L250/public/index.php/api/albums';\r\n\r\n  constructor(private http: HttpClient) {\r\n  }\r\n\r\n  getAlbums(): Observable<Object> {\r\n    return this.http.get(`${this.apiUrl}/albums`);\r\n  }\r\n\r\n  getAlbum(id: number): Observable<any> {\r\n    return from(\r\n      fetch(`${this.apiUrl}/albums/${id}`)\r\n        .then(response => response.json())\r\n    );\r\n  }\r\n  getSong(id: number): Observable<any> {\r\n    return this.http.get(`${this.apiUrl}/songs/${id}`);\r\n  }\r\n\r\n\r\n  searchSongs(query: string): Observable<any> {\r\n    return this.http.get(`${this.apiUrl}/songs?title=${query}`).pipe(\r\n      map((response: any) => {\r\n        if (Array.isArray(response)) {\r\n          return response;\r\n        } else {\r\n          return [response];\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  searchArtists(query: string): Observable<any> {\r\n    return this.http.get(`${this.apiUrl}/artists?name=${query}`).pipe(\r\n      map((response: any) => {\r\n        if (Array.isArray(response)) {\r\n          return response;\r\n        } else {\r\n          return [response];\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  searchAlbums(query: string): Observable<any> {\r\n    return this.http.get(`${this.apiUrl}/albums?title=${query}`).pipe(\r\n      map((response: any) => {\r\n          if (Array.isArray(response)) {\r\n            return response;\r\n          } else {\r\n            return [response];\r\n          }\r\n        }\r\n      ));\r\n  }\r\n\r\n/*  searchPlaylists(keyword: string): Observable<Playlist[]> {\r\n    const url = `${this.apiUrl}/playlists?q=${keyword}`;\r\n    return this.http.get<Playlist[]>(url);\r\n  }*/\r\n\r\n  getArtistAlbums(artistName: string, page?: number): Observable<Album[]> {\r\n    let params = new HttpParams()\r\n      .set('artist.name', artistName);\r\n    if (page) {\r\n      params = params.set('page', page.toString());\r\n    }\r\n    return this.http.get<Album[]>(this.apiUrls, { params });\r\n  }\r\n\r\n  getAllPlaylists(searchTerm?: string): Observable<any> {\r\n    let id = 1;\r\n    const playlists: any[] = [];\r\n\r\n    return new Observable(observer => {\r\n      const getPlaylist = () => {\r\n        let params = new HttpParams();\r\n        if (searchTerm) {\r\n          params = params.append('q', searchTerm);\r\n        }\r\n        this.http.get(`${this.apiUrl}/playlists/${id}`, { params }).pipe(\r\n          map((response: any) => {\r\n            if (!searchTerm || response.name.toLowerCase().includes(searchTerm.toLowerCase())) {\r\n              playlists.push(response);\r\n            }\r\n            id++;\r\n            if (response.id) {\r\n              // continue the loop\r\n              getPlaylist();\r\n            } else {\r\n              observer.next(playlists);\r\n              observer.complete();\r\n            }\r\n          }),\r\n          catchError(error => {\r\n            // stop the loop and return the playlists that have been fetched so far\r\n            observer.next(playlists);\r\n            observer.complete();\r\n            return [];\r\n          }),\r\n          takeWhile(() => id < 1000) // limit the loop to a maximum of 1000 iterations\r\n        ).subscribe();\r\n      };\r\n\r\n      getPlaylist();\r\n    });\r\n  }\r\n}\r\n\r\nexport interface Album {\r\n  id: number;\r\n  title: string;\r\n  image: string;\r\n}\r\n\r\nexport interface Playlist {\r\n  id: number;\r\n  name: string;\r\n  songs: Song[];\r\n}\r\n\r\nexport interface Song {\r\n  id: number;\r\n  title: string;\r\n  length: number;\r\n  youtube : string;\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}